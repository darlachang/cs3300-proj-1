<html>
<head>
<title>Project1</title>
<link href="https://fonts.googleapis.com/css?family=Alegreya|Alegreya+Sans" rel="stylesheet">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/default.min.css">
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="http://d3js.org/topojson.v2.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
<style>
body { font-family: 'Alegreya Sans', Calibri, sans-serif; }
svg { border: solid #ccc 1px; }
path.country { fill: #ddd; stroke: #ddd; opacity: 0.3 }
</style>
</head>
<body>

<svg>
</svg>

<script>

var svg = d3.select("svg").attr("width", 1500).attr("height",1000);

var padding = {left:20, right: 80, top:80, bottom:20};
var countryData;
var longScale = d3.scaleLinear()
				.domain([-140,180])
				.range([0,1400]);
var latScale = d3.scaleLinear()
				.domain([-70,70])
				.range([1000,0]);


d3.tsv("country.tsv", function (error, data) {
	if(error) { console.log(error);}

	countryData = data.map(function(d){
		country = d.Country;
		population = d.pop2015;
		size = d.landSqMi;
		best = d.numOneFor;
		gdp = d.GDP;
		gdpcapita= d.GDPperCapita;
		longEW = d.longEW;
		latNS = d.latNS;
		return {"name":country, 
		"pop": population,
		"best": best,
		"gdp": gdp,
		"gdpcapita": gdpcapita,
		"long" : longEW,
		"lat" : latNS };
	});

	countryData = countryData.filter(function (d) {return +d.gdp !=0;})
	showBubble(countryData);

});

function showBubble(data){

	var gdpScale = d3.scaleLinear()
					.domain([984074074,18036648000000])
					.range([30,120]);
	var gdpCapScale = d3.scaleLinear()
					.domain([277,101450])
					.range([0,10]);

	var colors = ["#f0f9e8","#ccebc5","#a8ddb5","#7bccc4","#43a2ca","#0868ac"]
	var gdpCapColor = d3.scaleOrdinal()
					.domain([0,2,4,6,8,10])
					.range(colors);

	for(var i=0; i<data.length; i++){
	console.log(data[i].name + " long : " + longScale(data[i].long) + " no scale " + data[i].long);
	console.log(data[i].name + " lat : " + latScale(data[i].lat)+ " no scale " + data[i].lat);

	svg.append("circle")
	.attr("cx", longScale(data[i].long))
	.attr("cy", latScale(data[i].lat))
	.attr("transform","translate(" + padding.left + "," + padding.top + ")")
	.text(data[i].name)
	.attr("r",gdpScale(data[i].gdp))
	.style("opacity", 0.4)
	.style("fill", gdpCapColor(Math.ceil(gdpCapScale(data[i].gdpcapita))+Math.ceil(gdpCapScale(data[i].gdpcapita))%2)); //round up to next even number

	svg.append("text")
	.attr("x", longScale(data[i].long))
	.attr("y", latScale(data[i].lat))
	.attr("transform","translate(" + padding.left + "," + padding.top + ")")
	.text(data[i].best)
	.style("font-size",15)
	.style("font-family","Alegreya")
	.style("text-anchor","middle")
	.style("fill", "black");

	svg.append("text")
	.attr("x", longScale(data[i].long))
	.attr("y", latScale(data[i].lat)+10)
	.attr("transform","translate(" + padding.left + "," + padding.top + ")")
	.text(data[i].name)
	.style("text-anchor","middle")
	.style("font-size",10)
	.style("fill", "black");

//might need to group elements later!
	}
}


</script>




</body>
</html>
